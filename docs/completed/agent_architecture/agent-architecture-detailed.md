# HAMA ì—ì´ì „íŠ¸ ì•„í‚¤í…ì²˜ ìƒì„¸ ì„¤ê³„

**ì‘ì„±ì¼**: 2025-10-03
**ëª©ì **: Phase 2 ì‹¤ì œ êµ¬í˜„ì„ ìœ„í•œ ê° ì—ì´ì „íŠ¸ì˜ ì—­í• , êµ¬ì¡°, ì„œë¸Œì—ì´ì „íŠ¸ ëª…ì„¸

---

## ğŸ“Š ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ì‚¬ìš©ì (Chat UI)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Master Agent       â”‚
                    â”‚  (LangGraph Router)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                      â†“                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Research      â”‚     â”‚ Strategy      â”‚     â”‚ Portfolio     â”‚
â”‚ Agent         â”‚     â”‚ Agent         â”‚     â”‚ Agent         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
        â†“                     â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Risk          â”‚     â”‚ Monitoring    â”‚     â”‚ Education     â”‚
â”‚ Agent         â”‚     â”‚ Agent         â”‚     â”‚ Agent         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Data Collection Agent  â”‚
                   â”‚  + Service Layer       â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ External Data Sources  â”‚
                   â”‚ - FinanceDataReader    â”‚
                   â”‚ - DART API             â”‚
                   â”‚ - News Crawler         â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ 1. Master Agent (graph_master.py)

### ì—­í•  (Responsibilities)

```python
"""
Master Agent - ë¼ìš°íŒ… ë° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜

í•µì‹¬ ì—­í• :
1. ì‚¬ìš©ì ì§ˆì˜ ì˜ë„ íŒŒì•… (Intent Analysis)
2. ì ì ˆí•œ ì„œë¸Œ ì—ì´ì „íŠ¸ ì„ íƒ ë° ìˆœì„œ ê²°ì • (Routing)
3. ì—ì´ì „íŠ¸ ê°„ ë°ì´í„° ì „ë‹¬ ë° ì¡°ìœ¨ (Orchestration)
4. HITL(Human-in-the-Loop) íŠ¸ë¦¬ê±° íŒë‹¨
5. ì—¬ëŸ¬ ì—ì´ì „íŠ¸ ê²°ê³¼ í†µí•© (Aggregation)

ì˜ì‚¬ê²°ì •:
- ì–´ë–¤ ì—ì´ì „íŠ¸ë¥¼ í˜¸ì¶œí•  ê²ƒì¸ê°€?
- ìˆœì°¨ ì‹¤í–‰ì¸ê°€, ë³‘ë ¬ ì‹¤í–‰ì¸ê°€?
- ì‚¬ìš©ì ê°œì…ì´ í•„ìš”í•œê°€?
- ê²°ê³¼ë¥¼ ì–´ë–»ê²Œ í†µí•©í•  ê²ƒì¸ê°€?
"""
```

### êµ¬ì¡°

**LangGraph StateGraph ê¸°ë°˜**:
- 6ê°œ ë…¸ë“œë¡œ êµ¬ì„±
- AgentStateë¡œ ìƒíƒœ ê´€ë¦¬

### ë…¸ë“œ (Nodes)

#### 1. analyze_intent
```python
def analyze_intent_node(state: AgentState) -> AgentState:
    """
    ì˜ë„ ë¶„ì„ ë…¸ë“œ

    ì…ë ¥: state["query"]
    ì¶œë ¥: state["intent"]

    ë¡œì§:
    - í‚¤ì›Œë“œ ê¸°ë°˜ ë¶„ë¥˜ (Phase 1)
    - LLM ê¸°ë°˜ ë¶„ë¥˜ (Phase 2)

    Intent ì¢…ë¥˜:
    - stock_analysis: ì¢…ëª© ë¶„ì„
    - trade_execution: ë§¤ë§¤ ì‹¤í–‰
    - portfolio_evaluation: í¬íŠ¸í´ë¦¬ì˜¤ í‰ê°€
    - rebalancing: ë¦¬ë°¸ëŸ°ì‹±
    - performance_check: ìˆ˜ìµë¥  ì¡°íšŒ
    - market_status: ì‹œì¥ ìƒí™©
    - general_question: ì¼ë°˜ ì§ˆë¬¸
    """
```

#### 2. determine_agents
```python
def determine_agents_node(state: AgentState) -> AgentState:
    """
    ì—ì´ì „íŠ¸ ê²°ì • ë…¸ë“œ

    ì…ë ¥: state["intent"]
    ì¶œë ¥: state["agents_to_call"]

    ë¼ìš°íŒ… ë§µ:
    stock_analysis â†’ [research, strategy, risk]
    trade_execution â†’ [strategy, risk]
    rebalancing â†’ [portfolio, strategy, risk]
    performance_check â†’ [portfolio]
    market_status â†’ [research, monitoring]
    general_question â†’ [education]
    """
```

#### 3. call_agents
```python
async def call_agents_node(state: AgentState) -> AgentState:
    """
    ì—ì´ì „íŠ¸ í˜¸ì¶œ ë…¸ë“œ

    ì…ë ¥: state["agents_to_call"]
    ì¶œë ¥: state["agent_results"] (ëˆ„ì )

    ë¡œì§:
    - asyncio.gatherë¡œ ë³‘ë ¬ í˜¸ì¶œ
    - ê° ì—ì´ì „íŠ¸ì˜ AgentOutput ìˆ˜ì§‘
    - ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ í•¸ë“¤ë§
    """
```

#### 4. check_risk
```python
def check_risk_node(state: AgentState) -> AgentState:
    """
    ë¦¬ìŠ¤í¬ ì²´í¬ ë…¸ë“œ

    ì…ë ¥: state["agent_results"]["risk_agent"]
    ì¶œë ¥: state["risk_level"]

    ë¦¬ìŠ¤í¬ ë ˆë²¨:
    - low: ì•ˆì „
    - medium: ì£¼ì˜
    - high: ê²½ê³  (HITL íŠ¸ë¦¬ê±° ê°€ëŠ¥)
    """
```

#### 5. check_hitl
```python
def check_hitl_node(state: AgentState) -> AgentState:
    """
    HITL íŠ¸ë¦¬ê±° íŒë‹¨ ë…¸ë“œ

    ì…ë ¥:
    - state["intent"]
    - state["risk_level"]
    - state["automation_level"]

    ì¶œë ¥: state["hitl_required"]

    íŠ¸ë¦¬ê±° ì¡°ê±´:
    1. ë§¤ë§¤ ì‹¤í–‰ (automation_level >= 2)
    2. ë¦¬ë°¸ëŸ°ì‹± (automation_level >= 1)
    3. ë¦¬ìŠ¤í¬ ë ˆë²¨ high
    4. Bull/Bear ì˜ê²¬ ì°¨ì´ < 10%
    """
```

#### 6. aggregate_results
```python
def aggregate_results_node(state: AgentState) -> AgentState:
    """
    ê²°ê³¼ í†µí•© ë…¸ë“œ

    ì…ë ¥: state["agent_results"]
    ì¶œë ¥:
    - state["summary"]
    - state["final_response"]

    ë¡œì§:
    - ê° ì—ì´ì „íŠ¸ ê²°ê³¼ë¥¼ í•˜ë‚˜ì˜ ì‘ë‹µìœ¼ë¡œ í†µí•©
    - HITL í•„ìš” ì‹œ approval_request ìƒì„±
    """
```

### Phase 2 ê°œì„  ì‚¬í•­

```python
# TODO Phase 2:
# - [ ] LLM ê¸°ë°˜ ì˜ë„ ë¶„ì„ (í˜„ì¬ëŠ” í‚¤ì›Œë“œ ë§¤ì¹­)
# - [ ] ë™ì  ë¼ìš°íŒ… (ì‚¬ìš©ì íˆìŠ¤í† ë¦¬ ê¸°ë°˜)
# - [ ] ì—ì´ì „íŠ¸ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì „ëµ
# - [ ] ë¶€ë¶„ ì‹¤íŒ¨ ì²˜ë¦¬ (ì¼ë¶€ ì—ì´ì „íŠ¸ë§Œ ì„±ê³µ)
```

---

## ğŸ” 2. Research Agent (research.py)

### ì—­í•  (Responsibilities)

```python
"""
Research Agent - ê¸°ì—… ë¶„ì„ ë° ë°ì´í„° ìˆ˜ì§‘

í•µì‹¬ ì—­í• :
1. ê¸°ì—… ì¬ë¬´ ë¶„ì„ (ì¬ë¬´ì œí‘œ, ë¹„ìœ¨ ë¶„ì„)
2. ê¸°ìˆ ì  ë¶„ì„ (ì°¨íŠ¸, ì§€í‘œ)
3. ë‰´ìŠ¤ ë° ê³µì‹œ ë¶„ì„ (ê°ì • ë¶„ì„ í¬í•¨)
4. ì¢…í•© í‰ê°€ ë° ë“±ê¸‰ ì‚°ì¶œ

ë°ì´í„° ì†ŒìŠ¤:
- FinanceDataReader (ì£¼ê°€ ë°ì´í„°)
- DART API (ì¬ë¬´ì œí‘œ, ê³µì‹œ)
- ë„¤ì´ë²„ ê¸ˆìœµ (ë‰´ìŠ¤)

ì¶œë ¥:
- ê¸°ì—… í‰ê°€ (rating 1-5)
- ì¶”ì²œ ì˜ê²¬ (BUY/HOLD/SELL)
- ëª©í‘œ ê°€ê²©
- ë¶„ì„ ê·¼ê±°
"""
```

### ì„œë¸Œ ì—ì´ì „íŠ¸ (Sub-Agents)

#### 2-1. Financial Analysis Sub-Agent
```python
class FinancialAnalysisSubAgent:
    """
    ì¬ë¬´ ë¶„ì„ ì„œë¸Œì—ì´ì „íŠ¸

    ì—­í• :
    - ì¬ë¬´ì œí‘œ ë¶„ì„ (ì†ìµê³„ì‚°ì„œ, ì¬ë¬´ìƒíƒœí‘œ, í˜„ê¸ˆíë¦„í‘œ)
    - ì¬ë¬´ë¹„ìœ¨ ê³„ì‚° (PER, PBR, ROE, ROA, ë¶€ì±„ë¹„ìœ¨ ë“±)
    - ì„±ì¥ì„± ë¶„ì„ (ë§¤ì¶œ ì„±ì¥ë¥ , ì´ìµ ì„±ì¥ë¥ )
    - ìˆ˜ìµì„± ë¶„ì„ (ì˜ì—…ì´ìµë¥ , ìˆœì´ìµë¥ )
    - ì•ˆì •ì„± ë¶„ì„ (ìœ ë™ë¹„ìœ¨, ë‹¹ì¢Œë¹„ìœ¨)

    ì…ë ¥:
    - corp_code (ê¸°ì—… ì½”ë“œ)
    - fiscal_year (íšŒê³„ì—°ë„)

    ì¶œë ¥:
    - financial_ratios: Dict[str, float]
    - growth_metrics: Dict[str, float]
    - profitability: Dict[str, float]
    - stability: Dict[str, float]

    TODO Phase 2:
    - [ ] DART API ì—°ë™ (ì¬ë¬´ì œí‘œ ì¡°íšŒ)
    - [ ] ì¬ë¬´ë¹„ìœ¨ ìë™ ê³„ì‚°
    - [ ] ì—…ì¢… í‰ê·  ëŒ€ë¹„ ë¹„êµ
    - [ ] ì‹œê³„ì—´ ì¶”ì„¸ ë¶„ì„ (3ë…„ì¹˜)
    """
```

#### 2-2. Technical Analysis Sub-Agent
```python
class TechnicalAnalysisSubAgent:
    """
    ê¸°ìˆ ì  ë¶„ì„ ì„œë¸Œì—ì´ì „íŠ¸

    ì—­í• :
    - ê¸°ìˆ ì  ì§€í‘œ ê³„ì‚° (RSI, MACD, Bollinger Bands, ì´ë™í‰ê· ì„ )
    - ì¶”ì„¸ ë¶„ì„ (ìƒìŠ¹/í•˜ë½/íš¡ë³´)
    - ì§€ì§€/ì €í•­ì„  ì‹ë³„
    - ë§¤ë§¤ ì‹œê·¸ë„ ìƒì„±

    ì…ë ¥:
    - stock_code
    - period (ë¶„ì„ ê¸°ê°„, ê¸°ë³¸ 90ì¼)

    ì¶œë ¥:
    - trend: str ("upward", "downward", "sideways")
    - indicators: Dict (RSI, MACD, etc.)
    - support_level: Decimal
    - resistance_level: Decimal
    - signals: List[str]

    TODO Phase 2:
    - [ ] FinanceDataReaderë¡œ ì£¼ê°€ ë°ì´í„° ìˆ˜ì§‘
    - [ ] TA-Lib ì—°ë™ (ê¸°ìˆ ì  ì§€í‘œ)
    - [ ] íŒ¨í„´ ì¸ì‹ (Head & Shoulders, Double Top ë“±)
    - [ ] ë³¼ë¥¨ ë¶„ì„
    """
```

#### 2-3. News & Sentiment Analysis Sub-Agent
```python
class NewsSentimentSubAgent:
    """
    ë‰´ìŠ¤ ë° ê°ì • ë¶„ì„ ì„œë¸Œì—ì´ì „íŠ¸

    ì—­í• :
    - ë‰´ìŠ¤ í¬ë¡¤ë§ (ë„¤ì´ë²„ ê¸ˆìœµ, ì¦ê¶Œ ë‰´ìŠ¤)
    - ê°ì • ë¶„ì„ (ê¸ì •/ë¶€ì •/ì¤‘ë¦½)
    - ê³µì‹œ ìš”ì•½ (ì¤‘ìš” ê³µì‹œ ì¶”ì¶œ)
    - ì´ìŠˆ ê°ì§€ (ê¸‰ë“±/ê¸‰ë½ ì›ì¸)

    ì…ë ¥:
    - stock_code
    - days (ìµœê·¼ Nì¼, ê¸°ë³¸ 7ì¼)

    ì¶œë ¥:
    - news: List[NewsItem]
        - title, url, published_at, source
        - sentiment: str ("positive", "negative", "neutral")
        - importance: str ("high", "medium", "low")
    - overall_sentiment_score: float (-1.0 ~ 1.0)
    - key_events: List[str]

    TODO Phase 2:
    - [ ] ë„¤ì´ë²„ ê¸ˆìœµ í¬ë¡¤ë§ (BeautifulSoup)
    - [ ] LLM ê¸°ë°˜ ê°ì • ë¶„ì„
    - [ ] DART ê³µì‹œ ìš”ì•½ (RAG í™œìš©)
    - [ ] ì¤‘ìš”ë„ ìë™ íŒë‹¨
    """
```

### í†µí•© í”„ë¡œì„¸ìŠ¤ (Main Process)

```python
class ResearchAgent(BaseAgent):
    async def process(self, input_data: AgentInput) -> AgentOutput:
        """
        ë©”ì¸ ë¦¬ì„œì¹˜ í”„ë¡œì„¸ìŠ¤

        1. ë°ì´í„° ìˆ˜ì§‘ (Data Collection Agent í˜¸ì¶œ)
        2. ì„œë¸Œ ì—ì´ì „íŠ¸ ë³‘ë ¬ ì‹¤í–‰
           - Financial Analysis
           - Technical Analysis
           - News Sentiment Analysis
        3. ê²°ê³¼ í†µí•©
        4. ì¢…í•© í‰ê°€ (LLM)

        TODO Phase 2:
        - [ ] 3ê°œ ì„œë¸Œì—ì´ì „íŠ¸ êµ¬í˜„
        - [ ] LLM ê¸°ë°˜ ì¢…í•© í‰ê°€
        - [ ] ëª©í‘œ ê°€ê²© ì‚°ì • ë¡œì§
        - [ ] í‰ê°€ ê·¼ê±° ìƒì„±
        """
```

---

## ğŸ’¡ 3. Strategy Agent (strategy.py)

### ì—­í•  (Responsibilities)

```python
"""
Strategy Agent - íˆ¬ì ì „ëµ ë° ë§¤ë§¤ ì‹œê·¸ë„

í•µì‹¬ ì—­í• :
1. Bull/Bear ë¶„ì„ (ìƒìŠ¹/í•˜ë½ ê·¼ê±°)
2. Consensus ê³„ì‚° (ì˜ê²¬ ì¢…í•©)
3. ë§¤ë§¤ ì‹œê·¸ë„ ìƒì„± (BUY/SELL/HOLD)
4. íƒ€ì´ë° ì „ëµ (ì§„ì…/ì²­ì‚° ì‹œì )
5. ë¦¬ìŠ¤í¬/ë¦¬ì›Œë“œ ë¹„ìœ¨ ê³„ì‚°

ì˜ì‚¬ê²°ì •:
- ì§€ê¸ˆ ë§¤ìˆ˜í•´ì•¼ í•˜ëŠ”ê°€?
- ëª©í‘œ ê°€ê²©ì€?
- ì†ì ˆê°€ëŠ”?
- Bullê³¼ Bear ì¤‘ ëˆ„ê°€ ë§ëŠ”ê°€?
"""
```

### ì„œë¸Œ ì—ì´ì „íŠ¸ (Sub-Agents)

#### 3-1. Bull Analyst Sub-Agent
```python
class BullAnalystSubAgent:
    """
    Bull ë¶„ì„ê°€ ì„œë¸Œì—ì´ì „íŠ¸

    ì—­í• :
    - ìƒìŠ¹ ê·¼ê±° ë¶„ì„
    - ê¸ì •ì  ìš”ì¸ ì‹ë³„
    - ìƒìŠ¹ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±
    - ê¸°ëŒ€ ìˆ˜ìµë¥  ê³„ì‚°

    ì…ë ¥:
    - stock_code
    - research_result (Research Agent ê²°ê³¼)

    ì¶œë ¥:
    - confidence: Decimal (0.0 ~ 1.0)
    - arguments: List[str] (ìƒìŠ¹ ê·¼ê±°)
    - expected_return: Decimal (ê¸°ëŒ€ ìˆ˜ìµë¥ )
    - key_catalysts: List[str] (ì£¼ìš” ìƒìŠ¹ ì´‰ë§¤)

    ë¶„ì„ ìš”ì†Œ:
    - ì‹¤ì  ê°œì„ 
    - ì—…í™© í˜¸ì „
    - ì‹ ì œí’ˆ/ì‹ ì‚¬ì—…
    - ë°¸ë¥˜ì—ì´ì…˜ ë§¤ë ¥
    - ê¸°ìˆ ì  ëŒíŒŒ

    TODO Phase 2:
    - [ ] LLM ê¸°ë°˜ ìƒìŠ¹ ê·¼ê±° ìƒì„±
    - [ ] Research Agent ê²°ê³¼ í™œìš©
    - [ ] ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚° ë¡œì§
    """
```

#### 3-2. Bear Analyst Sub-Agent
```python
class BearAnalystSubAgent:
    """
    Bear ë¶„ì„ê°€ ì„œë¸Œì—ì´ì „íŠ¸

    ì—­í• :
    - í•˜ë½ ê·¼ê±° ë¶„ì„
    - ë¶€ì •ì  ìš”ì¸ ì‹ë³„
    - í•˜ë½ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±
    - ì˜ˆìƒ ì†ì‹¤ ê³„ì‚°

    ì…ë ¥:
    - stock_code
    - research_result

    ì¶œë ¥:
    - confidence: Decimal (0.0 ~ 1.0)
    - arguments: List[str] (í•˜ë½ ê·¼ê±°)
    - expected_loss: Decimal (ì˜ˆìƒ ì†ì‹¤ë¥ )
    - risk_factors: List[str] (ì£¼ìš” ë¦¬ìŠ¤í¬)

    ë¶„ì„ ìš”ì†Œ:
    - ì‹¤ì  ì•…í™”
    - ì—…í™© ë‘”í™”
    - ê²½ìŸ ì‹¬í™”
    - ë°¸ë¥˜ì—ì´ì…˜ ë¶€ë‹´
    - ê¸°ìˆ ì  ì•½ì„¸

    TODO Phase 2:
    - [ ] LLM ê¸°ë°˜ í•˜ë½ ê·¼ê±° ìƒì„±
    - [ ] Research Agent ê²°ê³¼ í™œìš©
    - [ ] ë¦¬ìŠ¤í¬ ìš”ì¸ ìë™ ì‹ë³„
    """
```

#### 3-3. Consensus Calculator Sub-Agent
```python
class ConsensusCalculatorSubAgent:
    """
    Consensus ê³„ì‚° ì„œë¸Œì—ì´ì „íŠ¸

    ì—­í• :
    - Bull/Bear ì˜ê²¬ ì¢…í•©
    - ìµœì¢… ë§¤ë§¤ ì‹œê·¸ë„ ìƒì„±
    - ì‹ ë¢°ë„ ê³„ì‚°
    - HITL íŠ¸ë¦¬ê±° íŒë‹¨ (ì˜ê²¬ ì°¨ì´ ì‘ì„ ë•Œ)

    ì…ë ¥:
    - bull_result
    - bear_result

    ì¶œë ¥:
    - consensus: str ("bullish", "bearish", "neutral")
    - consensus_strength: str ("strong", "moderate", "weak")
    - final_signal: str ("BUY", "SELL", "HOLD")
    - confidence_score: Decimal
    - should_trigger_hitl: bool (ì˜ê²¬ ì°¨ì´ < 10%p)

    ë¡œì§:
    - Bull confidence > Bear confidence + 0.15 â†’ BUY
    - Bear confidence > Bull confidence + 0.15 â†’ SELL
    - ì°¨ì´ < 0.15 â†’ HOLD ë˜ëŠ” HITL

    TODO Phase 2:
    - [ ] Consensus ê³„ì‚° ì•Œê³ ë¦¬ì¦˜
    - [ ] HITL íŠ¸ë¦¬ê±° ì¡°ê±´ êµ¬í˜„
    - [ ] ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚°
    """
```

### í†µí•© í”„ë¡œì„¸ìŠ¤

```python
class StrategyAgent(BaseAgent):
    async def process(self, input_data: AgentInput) -> AgentOutput:
        """
        ë©”ì¸ ì „ëµ í”„ë¡œì„¸ìŠ¤

        1. Research Agent ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
        2. Bull/Bear ì„œë¸Œì—ì´ì „íŠ¸ ë³‘ë ¬ ì‹¤í–‰
        3. Consensus ê³„ì‚°
        4. ë§¤ë§¤ ì‹œê·¸ë„ ë° íƒ€ì´ë° ì „ëµ ìƒì„±
        5. HITL í•„ìš” ì‹œ íŠ¸ë¦¬ê±°

        TODO Phase 2:
        - [ ] 3ê°œ ì„œë¸Œì—ì´ì „íŠ¸ êµ¬í˜„
        - [ ] ëª©í‘œê°€/ì†ì ˆê°€ ê³„ì‚° ë¡œì§
        - [ ] íƒ€ì´ë° ì „ëµ (ì§„ì… ì „ëµ)
        - [ ] LLM í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§
        """
```

---

## âš ï¸ 4. Risk Agent (risk.py)

### ì—­í•  (Responsibilities)

```python
"""
Risk Agent - ë¦¬ìŠ¤í¬ í‰ê°€ ë° ê²½ê³ 

í•µì‹¬ ì—­í• :
1. í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬ìŠ¤í¬ ì¸¡ì • (VaR, ë³€ë™ì„±)
2. ì§‘ì¤‘ë„ ë¦¬ìŠ¤í¬ ë¶„ì„ (ì¢…ëª©/ì„¹í„° ë¹„ì¤‘)
3. ì†ì‹¤ ì‹œë®¬ë ˆì´ì…˜ (Monte Carlo)
4. ë¦¬ìŠ¤í¬ ì„ê³„ê°’ ì²´í¬
5. ê²½ê³  ë©”ì‹œì§€ ìƒì„±

HITL íŠ¸ë¦¬ê±° ì¡°ê±´:
- ê°œë³„ ì¢…ëª© ë¹„ì¤‘ > 20%
- ì„¹í„° ë¹„ì¤‘ > 40%
- ì˜ˆìƒ VaR > ëª©í‘œ ì†ì‹¤ë¥ 
- ê¸‰ê²©í•œ í¬íŠ¸í´ë¦¬ì˜¤ ë³€ê²½ (30% ì´ìƒ)
"""
```

### ì„œë¸Œ ì—ì´ì „íŠ¸ ì—†ìŒ (ë‹¨ì¼ ì—ì´ì „íŠ¸)

### ì£¼ìš” ê¸°ëŠ¥

#### 4-1. VaR (Value at Risk) ê³„ì‚°
```python
async def calculate_var(self, portfolio, confidence=0.95):
    """
    VaR ê³„ì‚°

    ë°©ë²•:
    - Historical VaR (ê³¼ê±° ë°ì´í„° ê¸°ë°˜)
    - Parametric VaR (ì •ê·œë¶„í¬ ê°€ì •)

    ì…ë ¥:
    - portfolio: í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±
    - confidence: ì‹ ë¢° ìˆ˜ì¤€ (95% ë˜ëŠ” 99%)

    ì¶œë ¥:
    - var_95: 95% ì‹ ë¢°ìˆ˜ì¤€ VaR
    - var_99: 99% ì‹ ë¢°ìˆ˜ì¤€ VaR

    TODO Phase 2:
    - [ ] Historical VaR êµ¬í˜„
    - [ ] numpy/scipy í™œìš©
    - [ ] í¬íŠ¸í´ë¦¬ì˜¤ ìƒê´€ê´€ê³„ ê³ ë ¤
    """
```

#### 4-2. ì§‘ì¤‘ë„ ë¦¬ìŠ¤í¬ ë¶„ì„
```python
async def analyze_concentration_risk(self, portfolio):
    """
    ì§‘ì¤‘ë„ ë¦¬ìŠ¤í¬ ë¶„ì„

    ì²´í¬ í•­ëª©:
    - ê°œë³„ ì¢…ëª© ë¹„ì¤‘
    - ì„¹í„° ë¹„ì¤‘
    - HHI (Herfindahl-Hirschman Index)

    ì„ê³„ê°’:
    - ê°œë³„ ì¢…ëª© > 20%: ê²½ê³ 
    - ì„¹í„° ë¹„ì¤‘ > 40%: ê²½ê³ 
    - HHI > 0.2: ê³ ì§‘ì¤‘

    TODO Phase 2:
    - [ ] HHI ê³„ì‚°
    - [ ] ì„¹í„° ë¶„ë¥˜ (GICS)
    - [ ] ë™ì  ì„ê³„ê°’ (ì‚¬ìš©ì ì„¤ì •)
    """
```

#### 4-3. Monte Carlo ì‹œë®¬ë ˆì´ì…˜
```python
async def run_monte_carlo(self, portfolio, iterations=10000):
    """
    Monte Carlo ì‹œë®¬ë ˆì´ì…˜

    ëª©ì :
    - ì˜ˆìƒ ì†ì‹¤/ìˆ˜ìµ ë¶„í¬ ê³„ì‚°
    - ìµœì•…ì˜ ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„
    - í™•ë¥ ì  ë¦¬ìŠ¤í¬ í‰ê°€

    ì…ë ¥:
    - portfolio
    - iterations (ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜)

    ì¶œë ¥:
    - expected_return: ê¸°ëŒ€ ìˆ˜ìµë¥ 
    - worst_case: ìµœì•…ì˜ ì‹œë‚˜ë¦¬ì˜¤ (1% ë°±ë¶„ìœ„ìˆ˜)
    - best_case: ìµœìƒì˜ ì‹œë‚˜ë¦¬ì˜¤ (99% ë°±ë¶„ìœ„ìˆ˜)

    TODO Phase 2:
    - [ ] GBM (Geometric Brownian Motion) ëª¨ë¸
    - [ ] numpy random í™œìš©
    - [ ] ìƒê´€ê´€ê³„ ê³ ë ¤
    """
```

---

## ğŸ“ 5. Portfolio Agent (portfolio.py)

### ì—­í•  (Responsibilities)

```python
"""
Portfolio Agent - í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„± ë° ìµœì í™”

í•µì‹¬ ì—­í• :
1. ìì‚° ë°°ë¶„ ìµœì í™” (Mean-Variance, Black-Litterman)
2. ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ (í˜„ì¬ vs ëª©í‘œ ë¹„êµ)
3. ê±°ë˜ ê³„íš ìƒì„± (ë§¤ìˆ˜/ë§¤ë„ ì£¼ë¬¸)
4. ì„±ê³¼ ì¸¡ì • (ìƒ¤í”„ ë¹„ìœ¨, ì•ŒíŒŒ, ë² íƒ€)
5. í¬íŠ¸í´ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜

ì˜ì‚¬ê²°ì •:
- ìµœì ì˜ ìì‚° ë°°ë¶„ì€?
- ë¦¬ë°¸ëŸ°ì‹±ì´ í•„ìš”í•œê°€?
- ì–´ë–¤ ì¢…ëª©ì„ ì–¼ë§ˆë‚˜ ì‚¬ê³  íŒ”ì•„ì•¼ í•˜ëŠ”ê°€?
"""
```

### ì„œë¸Œ ì—ì´ì „íŠ¸ (Sub-Agents)

#### 5-1. Portfolio Optimizer Sub-Agent
```python
class PortfolioOptimizerSubAgent:
    """
    í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ì„œë¸Œì—ì´ì „íŠ¸

    ì—­í• :
    - Mean-Variance ìµœì í™”
    - ìƒ¤í”„ ë¹„ìœ¨ ìµœëŒ€í™”
    - ì œì•½ ì¡°ê±´ ì ìš© (ìµœëŒ€ ë¹„ì¤‘, ì„¹í„° ì œí•œ ë“±)

    ì…ë ¥:
    - candidate_stocks: List[str] (í›„ë³´ ì¢…ëª©)
    - constraints: Dict (ì œì•½ ì¡°ê±´)
    - objective: str ("max_sharpe", "min_volatility")

    ì¶œë ¥:
    - optimal_weights: Dict[str, Decimal] (ì¢…ëª©ë³„ ë¹„ì¤‘)
    - expected_return: Decimal
    - expected_volatility: Decimal
    - sharpe_ratio: Decimal

    ì•Œê³ ë¦¬ì¦˜:
    - Markowitz Mean-Variance
    - cvxpy ë˜ëŠ” scipy.optimize ì‚¬ìš©

    TODO Phase 2:
    - [ ] Mean-Variance ìµœì í™” êµ¬í˜„
    - [ ] ì œì•½ ì¡°ê±´ ì²˜ë¦¬ (ìµœì†Œ/ìµœëŒ€ ë¹„ì¤‘)
    - [ ] Black-Litterman ëª¨ë¸ (ì„ íƒ)
    """
```

#### 5-2. Rebalancing Calculator Sub-Agent
```python
class RebalancingCalculatorSubAgent:
    """
    ë¦¬ë°¸ëŸ°ì‹± ê³„ì‚° ì„œë¸Œì—ì´ì „íŠ¸

    ì—­í• :
    - í˜„ì¬ vs ëª©í‘œ ë¹„ì¤‘ ë¹„êµ
    - í•„ìš”í•œ ê±°ë˜ ê³„ì‚°
    - ê±°ë˜ ë¹„ìš© ê³ ë ¤
    - ì„¸ê¸ˆ ìµœì í™” (ì„ íƒ)

    ì…ë ¥:
    - current_portfolio
    - target_portfolio
    - total_value

    ì¶œë ¥:
    - trades_required: List[Trade]
        - action: "BUY" | "SELL"
        - stock_code
        - amount (ê¸ˆì•¡)
        - quantity (ìˆ˜ëŸ‰)
    - estimated_cost: Decimal (ê±°ë˜ ë¹„ìš©)
    - tax_impact: Decimal (ì„¸ê¸ˆ ì˜í–¥, ì„ íƒ)

    ë¡œì§:
    - ë¹„ì¤‘ ì°¨ì´ ê³„ì‚°
    - ë§¤ë„ ìš°ì„  â†’ ë§¤ìˆ˜ ì‹¤í–‰
    - ìµœì†Œ ê±°ë˜ ë‹¨ìœ„ ê³ ë ¤

    TODO Phase 2:
    - [ ] ë¦¬ë°¸ëŸ°ì‹± ì•Œê³ ë¦¬ì¦˜
    - [ ] ê±°ë˜ ë¹„ìš© ê³„ì‚°
    - [ ] ìµœì†Œ ê±°ë˜ ê¸ˆì•¡ í•„í„°ë§
    """
```

### í†µí•© í”„ë¡œì„¸ìŠ¤

```python
class PortfolioAgent(BaseAgent):
    async def process(self, input_data: AgentInput) -> AgentOutput:
        """
        ë©”ì¸ í¬íŠ¸í´ë¦¬ì˜¤ í”„ë¡œì„¸ìŠ¤

        1. í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ ì¡°íšŒ (DB)
        2. ìµœì  í¬íŠ¸í´ë¦¬ì˜¤ ê³„ì‚° (Optimizer)
        3. ë¦¬ë°¸ëŸ°ì‹± í•„ìš”ì„± íŒë‹¨
        4. ê±°ë˜ ê³„íš ìƒì„± (Rebalancing Calculator)
        5. ì„±ê³¼ ì¸¡ì • (ì•ŒíŒŒ, ë² íƒ€, ìƒ¤í”„ ë¹„ìœ¨)

        TODO Phase 2:
        - [ ] 2ê°œ ì„œë¸Œì—ì´ì „íŠ¸ êµ¬í˜„
        - [ ] DB ì—°ë™ (í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ ì¡°íšŒ)
        - [ ] ì„±ê³¼ ì¸¡ì • ë¡œì§
        """
```

---

## ğŸ“¡ 6. Monitoring Agent (monitoring.py)

### ì—­í•  (Responsibilities)

```python
"""
Monitoring Agent - ì‹œì¥ ë° í¬íŠ¸í´ë¦¬ì˜¤ ëª¨ë‹ˆí„°ë§

í•µì‹¬ ì—­í• :
1. ê°€ê²© ë³€ë™ ì¶”ì  (ê¸‰ë“±/ê¸‰ë½ ê°ì§€)
2. ì´ë²¤íŠ¸ ê°ì§€ (ê±°ë˜ëŸ‰ ê¸‰ì¦, VI ë°œë™ ë“±)
3. ê³µì‹œ ëª¨ë‹ˆí„°ë§ (ì¤‘ìš” ê³µì‹œ ì•Œë¦¼)
4. ë‰´ìŠ¤ ëª¨ë‹ˆí„°ë§ (ì¢…ëª© ê´€ë ¨ ë‰´ìŠ¤)
5. ì •ê¸° ë¦¬í¬íŠ¸ ìƒì„±

ì‘ë™ ë°©ì‹:
- ëª…ì‹œì  ìš”ì²­: ì‚¬ìš©ìê°€ "ì‚¼ì„±ì „ì ì´ìŠˆëŠ”?" ì§ˆë¬¸
- ì£¼ê¸°ì : ì¼ì¼/ì£¼ê°„/ì›”ê°„ ë¦¬í¬íŠ¸
- íŠ¸ë¦¬ê±°: ê°€ê²© ë³€ë™ > Â±10%, ì¤‘ìš” ê³µì‹œ ë“±

TODO Phase 2 í›„ë°˜:
- [ ] ì‹¤ì‹œê°„ ê°€ê²© ì¶”ì 
- [ ] ì´ë²¤íŠ¸ ê°ì§€ ë¡œì§
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ (Email, Push)
"""
```

### ì„œë¸Œ ì—ì´ì „íŠ¸ ì—†ìŒ (ë‹¨ì¼ ì—ì´ì „íŠ¸)

---

## ğŸ“š 7. Education Agent (education.py)

### ì—­í•  (Responsibilities)

```python
"""
Education Agent - íˆ¬ì êµìœ¡ ë° ì§ˆì˜ì‘ë‹µ

í•µì‹¬ ì—­í• :
1. íˆ¬ì ìš©ì–´ ì„¤ëª…
2. ì¼ë°˜ ì‹œì¥ ì§ˆë¬¸ ë‹µë³€
3. íˆ¬ì ì „ëµ êµìœ¡
4. ë§¥ë½ì— ë§ëŠ” ì½˜í…ì¸  ì¶”ì²œ

íŠ¹ì§•:
- HITL íŠ¸ë¦¬ê±° ì—†ìŒ (ì™„ì „ ìë™)
- LLM ê¸°ë°˜ ì‘ë‹µ
- RAG í™œìš© (íˆ¬ì ìš©ì–´ DB)

TODO Phase 2 í›„ë°˜:
- [ ] íˆ¬ì ìš©ì–´ ì‚¬ì „ DB êµ¬ì¶•
- [ ] RAG ê¸°ë°˜ Q&A
- [ ] LLM í”„ë¡¬í”„íŠ¸ ìµœì í™”
"""
```

### ì„œë¸Œ ì—ì´ì „íŠ¸ ì—†ìŒ (ë‹¨ì¼ ì—ì´ì „íŠ¸)

---

## ğŸ‘¤ 8. Personalization Agent (personalization.py)

### ì—­í•  (Responsibilities)

```python
"""
Personalization Agent - ì‚¬ìš©ì í”„ë¡œí•„ ë° ì„ í˜¸ë„ ê´€ë¦¬

í•µì‹¬ ì—­í• :
1. ì‚¬ìš©ì í”„ë¡œí•„ CRUD
2. íˆ¬ì ì„±í–¥ ê´€ë¦¬ (ë¦¬ìŠ¤í¬ í—ˆìš©ë„, ëª©í‘œ ë“±)
3. ì„ í˜¸/íšŒí”¼ ì¢…ëª©/ì„¹í„° ê´€ë¦¬
4. ìë™í™” ë ˆë²¨ ì¡°ì •

Phase 2 ì¶”ê°€:
5. ì‚¬ìš©ì í–‰ë™ í•™ìŠµ (ìŠ¹ì¸/ê±°ë¶€ íŒ¨í„´)
6. ê°œì¸í™” ì¶”ì²œ
7. ë§ì¶¤í˜• ì•Œë¦¼ ì„¤ì •

TODO Phase 2 ì¤‘ë°˜:
- [ ] ì‚¬ìš©ì í”„ë¡œí•„ CRUD API
- [ ] DB ìŠ¤í‚¤ë§ˆ ì—°ë™ (users í…Œì´ë¸”)
- [ ] íˆ¬ì ì„±í–¥ ì§„ë‹¨ ë¡œì§
"""
```

### ì„œë¸Œ ì—ì´ì „íŠ¸ ì—†ìŒ (ë‹¨ì¼ ì—ì´ì „íŠ¸)

---

## ğŸ—‚ï¸ 9. Data Collection Agent (data_collection.py) â­ í•µì‹¬

### ì—­í•  (Responsibilities)

```python
"""
Data Collection Agent - ì¤‘ì•™í™”ëœ ë°ì´í„° ìˆ˜ì§‘

í•µì‹¬ ì—­í• :
1. ëª¨ë“  ì™¸ë¶€ ë°ì´í„° ì†ŒìŠ¤ í†µí•© ê´€ë¦¬
2. ë°ì´í„° ìºì‹± (Redis)
3. API ë ˆì´íŠ¸ ë¦¬ë°‹ ê´€ë¦¬
4. ì—ëŸ¬ í•¸ë“¤ë§ ë° ì¬ì‹œë„

ë°ì´í„° íƒ€ì…:
- stock_price: ì£¼ê°€ ë°ì´í„° (FinanceDataReader)
- financial_statement: ì¬ë¬´ì œí‘œ (DART API)
- dart_disclosure: ê³µì‹œ ë¬¸ì„œ (DART API)
- news: ë‰´ìŠ¤ (í¬ë¡¤ë§)
- realtime_quote: ì‹¤ì‹œê°„ í˜¸ê°€ (KIS API, Phase 3)

ì¤‘ìš”ì„±:
- ë‹¤ë¥¸ ëª¨ë“  ì—ì´ì „íŠ¸ê°€ ì˜ì¡´
- ìºì‹±ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
- API í˜¸ì¶œ ì¤‘ë³µ ë°©ì§€
"""
```

### Service Layer ì˜ì¡´

```python
class DataCollectionAgent(BaseAgent):
    """
    Service Layerë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ìˆ˜ì§‘

    ì˜ì¡´ì„±:
    - StockDataService (FinanceDataReader)
    - DARTService (DART API)
    - NewsCrawlerService (ë„¤ì´ë²„ ê¸ˆìœµ)
    - CacheManager (Redis)

    TODO Phase 2 (ìµœìš°ì„ ):
    - [ ] 3ê°œ Service êµ¬í˜„
    - [ ] Redis ìºì‹± í†µí•©
    - [ ] ì—ëŸ¬ í•¸ë“¤ë§ (ì¬ì‹œë„ ë¡œì§)
    - [ ] ë°ì´í„° ì •ê·œí™”
    """
```

---

## ğŸ“Š ì—ì´ì „íŠ¸ ê°„ ì˜ì¡´ì„± ë§µ

```
Master Agent
    â”œâ”€ Research Agent
    â”‚   â””â”€ Data Collection Agent
    â”‚       â””â”€ Service Layer
    â”‚           â”œâ”€ FinanceDataReader
    â”‚           â”œâ”€ DART API
    â”‚           â””â”€ News Crawler
    â”‚
    â”œâ”€ Strategy Agent
    â”‚   â””â”€ Research Agent (ê²°ê³¼ í™œìš©)
    â”‚
    â”œâ”€ Risk Agent
    â”‚   â””â”€ Portfolio Agent (í¬íŠ¸í´ë¦¬ì˜¤ ì •ë³´)
    â”‚
    â”œâ”€ Portfolio Agent
    â”‚   â””â”€ Data Collection Agent
    â”‚
    â”œâ”€ Monitoring Agent
    â”‚   â””â”€ Data Collection Agent
    â”‚
    â”œâ”€ Education Agent
    â”‚   â””â”€ (ë…ë¦½ì , ì™¸ë¶€ ì˜ì¡´ ì—†ìŒ)
    â”‚
    â””â”€ Personalization Agent
        â””â”€ DBë§Œ ì˜ì¡´
```

---

## ğŸš€ Phase 2 êµ¬í˜„ ìš°ì„ ìˆœìœ„

```
Week 11-12: Service Layer + Cache
    â”œâ”€ StockDataService (FinanceDataReader)
    â”œâ”€ DARTService (DART API)
    â”œâ”€ NewsCrawlerService
    â””â”€ CacheManager (Redis)

Week 13: Data Collection Agent
    â””â”€ ì‹¤ì œ êµ¬í˜„ (Service Layer í†µí•©)

Week 14-16: Research Agent
    â”œâ”€ Financial Analysis Sub-Agent
    â”œâ”€ Technical Analysis Sub-Agent
    â””â”€ News Sentiment Sub-Agent

Week 17-19: Strategy Agent
    â”œâ”€ Bull Analyst Sub-Agent
    â”œâ”€ Bear Analyst Sub-Agent
    â””â”€ Consensus Calculator Sub-Agent

Week 20-22: Portfolio Agent
    â”œâ”€ Portfolio Optimizer Sub-Agent
    â””â”€ Rebalancing Calculator Sub-Agent

Week 23-24: Risk Agent
    â”œâ”€ VaR ê³„ì‚°
    â”œâ”€ ì§‘ì¤‘ë„ ë¦¬ìŠ¤í¬
    â””â”€ Monte Carlo ì‹œë®¬ë ˆì´ì…˜

Week 25-26: Monitoring, Education, Personalization
```

---

**ì‘ì„±ì**: Claude Code
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-03
**ë‹¤ìŒ ë‹¨ê³„**: Phase 1 ì™„ë£Œ â†’ Service Layer êµ¬ì¶• ì‹œì‘