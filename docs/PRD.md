# PRD v1.2

종류: PRD
버전: 1.3
생성일: 2025년 9월 30일 오후 7:12
최종 편집일시: 2025년 11월 1일
담당자: 지우 최
Changelog: Phase 1 구현 완료 상태 반영, HITL 시스템 확장 반영

<aside>

### 과거 버전

[PRD 초안](https://www.notion.so/PRD-27e630957afa8092be92cb3ceead6a7d?pvs=21)

</aside>

## 1. Executive Summary

개인 투자자를 위한 **Human-in-the-Loop(HITL) 기반 멀티 에이전트 AI 투자 시스템**을 개발한다.

**핵심 가설**: 투자자는 귀찮은 정보 분석은 하기 싫어하지만, 종목 선택과 매매 실행은 직접 하고 싶어한다.

이 가설을 바탕으로, AI가 데이터 수집 및 분석을 자동화하되, 전략 수립과 매매 결정에서는 사용자가 원하는 만큼의 통제권을 행사할 수 있는 **선택 가능한 자동화 시스템**을 구축한다.

---

## 2. Product Vision & Goals

### 2.1 Vision

**"AI가 분석하고, 당신이 결정한다"**

투자자는 복잡한 데이터 분석에서 해방되면서도, 자신의 직관과 판단력을 발휘할 수 있는 투자 경험을 제공한다.

### 2.2 Core Value Proposition

**AI의 자동화 편리성 + 인간의 직관/통제욕구 동시 충족**

| AI의 역할 | 인간의 역할 |
| --- | --- |
| 📊 데이터 수집 및 정제 | 🎯 최종 종목 선택 |
| 🔍 기업 분석 및 리스크 평가 | ✅ 매매 실행 승인 |
| 💡 전략 제안 및 시뮬레이션 | 🎨 포트폴리오 조정 |
| ⚠️ 리스크 경고 및 대안 제시 | 🧭 투자 방향성 설정 |

### 2.3 Product Goals

1. **사용자 통제감 보장**
    - 자동화 수준을 사용자가 선택하고 언제든 조정 가능
    - 중요한 의사결정은 반드시 사용자 개입
2. **분석 부담 제거**
    - AI가 수천 개 데이터 포인트를 자동 분석
    - 핵심 인사이트만 간결하게 제공
3. **점진적 학습 지원**
    - 사용자가 투자 경험을 쌓으면서 자연스럽게 자율성 증가
    - AI의 추론 근거를 통해 투자 학습 효과

---

## 3. HITL Intervention System

### 3.1 3단계 개입 모드

| 레벨 | 모드명 | 설명 | AI 자율성 | 사용자 개입 빈도 | 추천 대상 |
| --- | --- | --- | --- | --- | --- |
| **1** | ✈️ 파일럿 모드 | AI가 거의 모든 것을 처리 | 85% | 월 1회 확인 | 바쁜 직장인, 초보자 |
| **2** | 🤝 코파일럿 모드 ⭐ | AI가 제안, 큰 결정만 승인 | 50% | 주 1-2회 알림 | 배우고 싶은 초보자 |
| **3** | 📊 어드바이저 모드 | AI는 정보만 제공, 사용자 결정 | 20% | 일일 검토 가능 | 중급 이상 투자자 |

⭐ **기본 추천**: 코파일럿 모드 (레벨 2)

### 3.2 모드별 개입 지점 매트릭스

| 프로세스 단계 | 파일럿 (Lv1) | 코파일럿 (Lv2) | 어드바이저 (Lv3) |
| --- | --- | --- | --- |
| 데이터 수집 | 자동 | 자동 | 자동 |
| 데이터 분석 | 자동 | 자동 | 자동 (요청 시 상세) |
| 전략 생성 | 자동 + 월 1회 리뷰 | **승인 필요** | **사용자 주도** |
| 포트폴리오 구성 | 자동 + 월 1회 리뷰 | **승인 필요** | **사용자 주도** |
| 매매 실행 | 자동 + 알림 | **승인 필요** | **승인 필수** |
| 리밸런싱 | 분기 1회 승인 | **승인 필요** | **승인 필수** |
| 모니터링 | 중요 이슈만 알림 | 주요 이슈 알림 | 상세 리포트 제공 |

### 3.3 모드 설정 및 변경

**초기 설정**

- 온보딩 과정의 '초기 스크리닝' 단계에서 설정
- 투자 경험, 시간 여유, 관여도 질문 기반 추천
- 사용자가 직접 모드를 선택 가능

**모드 변경**

- 설정 메뉴에서 언제든 변경 가능
- 변경 시 영향 받는 부분 미리 고지
- 예: "코파일럿 → 파일럿 변경 시, 향후 포트폴리오 조정은 자동으로 진행되며 월 1회 리뷰만 제공됩니다."

**커스터마이징**

- 각 모드 내에서 세부 개입 지점 조정 가능
- 예: 코파일럿 모드이지만 "매매 실행만 자동"으로 설정
- UI: 토글 스위치 형태로 각 단계별 설정

---

## 4. System Architecture

### 4.1 Multi-Agent Architecture

**현재 구현 아키텍처 (Router 기반 단순화 구조)**

```
                    사용자 (Chat Interface)
                           ↕
                    Router Agent ⭐
                (단일 진입점 - 질문 분석 및 실행 조율)
                   Claude Sonnet 4.5
                - 3단계 우선순위 라우팅:
                  1) Worker 직접 호출 (초고속)
                  2) 직접 답변 (간단한 질문)
                  3) 에이전트 호출 (분석/전략/실행)
                - 종목명 추출 & 개인화 설정
                - 대화 히스토리 처리
                           ↓
        ┌─────────┬────────┼────────┬─────────┬─────────┐
        ↓         ↓        ↓        ↓         ↓         ↓
   Research  Strategy   Risk   Trading Portfolio Monitoring
  (8 Workers)(6 Spec) (단일) (3 Nodes)(3 Nodes)  (배경 전용)
   [HITL]    [HITL]          [HITL]   [HITL]

   Report Generator ← 구현 완료, 미등록
```

**아키텍처 변경 이력 (2025-11-09):**
- ❌ **Supervisor 제거**: Router와 중복 라우팅, /multi-stream이 메인이므로 불필요
- ❌ **/chat 엔드포인트 제거**: 레거시, /multi-stream으로 통합
- ✅ **Router Agent 강화**: 단일 진입점으로 모든 라우팅 처리
- ✅ **Trading Agent 단순화**: 9 노드 → 3 노드 (58% 코드 감소, LLM 호출 80% 감소)

**기술 스택:**
- **API**: `/multi-stream` (SSE 스트리밍)
- **Router**: Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)
- **Agents**: LangGraph Subgraph 패턴
- **Checkpointer**: PostgreSQL (프로덕션) / Memory (개발)

### 4.2 주요 에이전트 상세

### Router Agent (질문 분석 및 라우팅)

**역할**: 사용자 질문을 분석하여 최적의 실행 계획 수립

**핵심 기능**
1. **질문 복잡도 분석**: simple / moderate / expert
2. **에이전트 선택**: research, strategy, risk, trading, portfolio
3. **답변 깊이 결정**: brief / detailed / comprehensive
4. **개인화 설정**: 사용자 전문성 수준에 맞춘 응답 조정

**3단계 우선순위 라우팅**

```
우선순위 1: 워커 직접 호출 (초고속 단순 조회)
├─ "삼성전자 현재가?" → stock_price worker
└─ "코스피 지수?" → index_price worker

우선순위 2: 에이전트 호출 (분석/전략/실행)
├─ "삼성전자 분석해줘" → research + strategy
├─ "매수 타이밍?" → strategy + risk
└─ "포트폴리오 진단" → portfolio + risk

우선순위 3: Router 직접 답변 (간단한 질문)
├─ "PER이 뭐야?" → Router가 직접 설명
└─ "안녕?" → Router가 직접 응답
```

**기술 스택**
- LLM: Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)
- Structured Output: Pydantic 모델 기반
- 평균 응답 시간: < 1초

### Supervisor (Master Agent - 조율자)

**역할**: 순수 조율자 (비즈니스 로직 수행하지 않음)

**핵심 기능**
1. **동적 에이전트 호출**: LLM 기반 실시간 판단
2. **병렬/순차 실행 관리**: 의존성에 따라 자동 조율
3. **결과 통합**: 여러 에이전트 결과를 하나로 통합
4. **상태 관리**: GraphState를 통한 에이전트 간 데이터 공유

**라우팅 원칙**

```
1. 직접 답변 우선: 투자 용어 설명 → 에이전트 호출 없음
2. 최소 에이전트: 필요한 에이전트만 호출
3. 병렬 vs 순차:
   - 병렬: 독립적인 에이전트 (예: 복수 종목 비교)
   - 순차: 의존성 있음 (예: 분석 → 매매)
4. 분석 깊이 선택:
   - Quick (1-3 workers): 단순 조회
   - Standard (4-5 workers): 세부 분석
   - Comprehensive (7 workers): 종합 분석
```

**핵심 시나리오**

```
사용자 질문 분류:
├─ 종목 분석/평가 → research (Comprehensive) + strategy + risk
├─ 매매 지시 → trading → HITL 트리거
├─ 포트폴리오 평가 → portfolio + risk
├─ 리밸런싱 → research + strategy + portfolio + risk → HITL
├─ 수익률/현황 → portfolio
├─ 시장 상황 → research (Macro + Bull/Bear) + strategy
└─ 일반 질문 → Router 직접 답변
```

**기술 스택**
- 프레임워크: `langgraph-supervisor` 라이브러리
- LLM: ROUTER_MODEL 설정 (기본: GPT-4o)
- Checkpointer: PostgreSQL / Memory
- Recursion Limit: 50 (Supervisor 패턴 최적화)

### 리서치 에이전트

**역할**: 데이터 수집 및 기업 분석 (완전 자동화)

- 실시간 시세 데이터 (한국투자증권 API)
- 공시 문서 분석 (DART API)
- 뉴스 및 이벤트 추적
- 재무제표 자동 분석 및 해석

**서브 에이전트 (Deep Agent 패턴)**

- **Data Worker**: 기본 데이터 수집 (가격, 재무제표, 시장지표)
- **Bull/Bear Analyst**: 상승/하락 시나리오 분석
- **Technical Analyst**: 기술적 분석 (이평선, RSI/MACD, 지지/저항선)
- **Trading Flow Analyst**: 거래 동향 분석 (외국인/기관/개인 수급)
- **Information Analyst**: 정보 분석 (뉴스 센티먼트, 호재/악재, 리스크)
- **Macro Worker**: 거시경제 지표 분석 (금리, 환율, 경제지표)
- **Insight Worker**: 심층 분석 및 인사이트 도출

**분석 통합**

- Planner가 쿼리 의도를 분석하여 필요한 Worker만 동적 선택
- Synthesis 노드에서 모든 전문가 분석 결과를 통합하여 최종 추천 생성

**동적 Worker 선택 시스템 (v1.2 신규)**

리서치 에이전트는 사용자 쿼리와 프로파일에 따라 필요한 Worker만 선택하여 비용과 시간을 최적화합니다.

**3-Tier 분석 깊이 시스템:**

| 레벨 | 설명 | Worker 수 | 소요 시간 | 비용 절감 | 적용 사례 |
| --- | --- | --- | --- | --- | --- |
| **Quick** | 빠른 분석 | 1-3개 | 10-20초 | 75-87% | "현재가?", "가격만 확인" |
| **Standard** ⭐ | 표준 분석 | 4-5개 | 30-45초 | 38-44% | "분석해줘", "기술적으로 어때?" |
| **Comprehensive** | 종합 분석 | 7-8개 | 60-90초 | 0% | "매수해도 될까?", "상세 분석" |

⭐ 기본값: Standard

**분석 깊이 결정 로직:**

1. **Query Intent Classifier**
   - 쿼리 키워드 분석: "빠르게" → quick, "상세히" → comprehensive
   - UserProfile 고려: preferred_depth (brief/detailed/comprehensive)
   - 복잡도 판단: 단순 정보 확인 vs 의사결정 필요
   - Focus Area 추출: "기술적" → technical worker 우선

2. **Smart Planner**
   - 분석 깊이에 따라 추천 Worker 리스트 생성
   - Focus Area를 우선적으로 포함
   - LLM에게 제한된 Worker 목록 제공 → 정확한 선택
   - 선택된 Worker가 추천 범위를 벗어나면 필터링

**예시:**

- "삼성전자 현재가?" → Quick (1-3 workers): data, technical
- "삼성전자 분석해줘" → Standard (4-5 workers): data, technical, trading_flow, bull, bear
- "삼성전자 매수해도 될까?" → Comprehensive (7-8 workers): 모든 workers 활용

**기대 효과:**
- 비용 절감: Quick 모드에서 최대 87% 절감
- 속도 향상: Quick 모드에서 78% 시간 단축
- 사용자 맞춤: 전문성 수준에 따른 분석 깊이 자동 조절

### 전략 에이전트 (Trading Agent)

**역할**: 투자 전략 제안 및 매매 실행 (자동화 레벨에 따라 HITL)

- 종목 추천 및 매수/매도 타이밍 분석
- 매수/매도 점수 시스템 (1-10점)
- 손절가/목표가 자동 계산 (Risk/Reward Ratio 1.5:1 이상)
- 투자 기간 제안 (단기/중기/장기)

**Specialist 노드**

- **Buy Specialist**: Research 결과 기반 매수 점수 산출 (1-10점)
  - 8-10점: 강력 매수 추천
  - 7점: 매수 고려
  - 6점 이하: 매수 부적합
  - 기술적/수급/정보/펀더멘털 종합 평가

- **Sell Specialist**: 매도 결정 로직
  - 손절가 도달 우선 검증
  - 목표가 달성 시 매도
  - 추세 반전 감지
  - 부정적 센티먼트 반영

- **Risk/Reward Calculator**: 손절가/목표가 계산
  - 투자 기간별 차등 적용 (단기 5%, 중기 10%, 장기 20%)
  - Risk/Reward Ratio 최소 1.5:1 보장
  - 매수 점수 기반 목표가 조정

**HITL 개입**

- 새로운 전략 제안 시 → 레벨 2,3 승인 필요
- 기존 전략 변경 시 → 모든 레벨 승인 필요
- 매매 실행 시 → 레벨 2,3 승인 필요
- 고위험 거래 감지 시 → 모든 레벨 승인 필요

### 리스크 에이전트

**역할**: 리스크 평가 및 경고 (자동 + HITL)

- 포트폴리오 리스크 측정
- 집중도 리스크 경고
- 손실 가능성 시뮬레이션
- 비정상 거래 패턴 감지

**HITL 트리거**

- 리스크 임계값 초과 (기본: 개별 종목 20% 이상)
- 예상 손실 > 월 목표 손실률
- 몰빵 시도 (특정 종목 50% 이상)
- 급격한 포트폴리오 변경 (30% 이상 변동)

**AI 권고 예시**

> "삼성전자에 전체 자산의 60%를 투자하려고 합니다.
> 
> 
> 📊 **과거 데이터 분석**
> 
> - 단일 종목 50% 이상 집중 시 평균 수익률: -8.3%
> - 최대 손실 가능성: 35%
> 
> ⚠️ **권장사항**: 비중을 30% 이하로 조정하거나, 같은 섹터 내 다른 종목으로 분산 투자를 고려하세요.
> 
> 정말로 매매하시겠습니까? [취소] [수정] [진행]"
> 

### 포트폴리오 에이전트

**역할**: 포트폴리오 구성 및 관리 (HITL)

- 자산 배분 최적화
- 리밸런싱 제안
- 성과 추적 및 리포팅
- 포트폴리오 제약 조건 검증

**핵심 노드**

- **Market Condition**: 시장 상황 분석 및 최대 슬롯 동적 조정
  - 강세장 (KOSPI +5% 이상): 최대 10개 종목
  - 중립장 (±5% 이내): 최대 7개 종목
  - 약세장 (KOSPI -5% 이상): 최대 5개 종목 (리스크 관리)

- **Optimize Allocation**: 포트폴리오 최적화
  - 샤프 비율 최대화
  - 위험 분산 전략
  - 섹터 다각화

- **Validate Constraints**: 포트폴리오 제약 조건 검증
  - 최대 슬롯 수 초과 여부 (high severity)
  - 섹터 집중도 (30% 제한, medium severity)
  - 동일 산업군 종목 수 (3개 제한, low severity)
  - 위반 시 경고 및 대안 제시

**포트폴리오 생성 시 사용자 개입 옵션**

**레벨 1 (파일럿)**: 단순 수용/거부

```
제안된 포트폴리오:
- 삼성전자 30%
- SK하이닉스 20%
- ...

[수용] [거부 후 재생성]
```

**레벨 2 (코파일럿)**: 3가지 옵션 제공

```
제안된 포트폴리오:
- 삼성전자 30%
- SK하이닉스 20%
- ...

[수용] [보수적으로 재생성] [공격적으로 재생성]

```

**레벨 3 (어드바이저)**: 상세 조정 + Chat 피드백

```
제안된 포트폴리오:
- 삼성전자 30% [비중 조정]
- SK하이닉스 20% [비중 조정]
- ...

또는 Chat으로 구체적 요청:
"반도체 비중을 40%로 줄이고, 2차전지를 20% 추가해줘"

```

### 모니터링 에이전트

**역할**: 시장 및 포트폴리오 모니터링 (자동 + 트리거)

**작동 방식**

1. **명시적 요청**
    - 사용자: "삼성전자 현재 이슈는?"
    - 즉시 분석 및 응답
2. **주기적 작동** (사용자 설정)
    - 일일 / 주간 / 월간 / 분기별 / 반기별 / 연간
    - 정기 리포트 생성
3. **트리거 기반 알림** (사용자 설정)
    - 보유 종목 가격 변동 > ±10%
    - 중요 공시 발표 (실적, 배당 등)
    - 섹터 이슈 발생
    - AI가 판단한 중요 시장 변화

### 교육/질의 에이전트

**역할**: 일반 투자 지식 제공 (완전 자동)

- 투자 용어 설명
- 시장 상황 해설
- 투자 전략 교육

**참고**: 현재 Router Agent가 간단한 질문에 직접 답변하므로, 교육/질의 에이전트는 Phase 2에서 구현 예정

### Report Generator Agent (통합 리포트 생성)

**역할**: Research + Strategy 결과를 통합하여 최종 Investment Dashboard 생성

**현재 상태**: ✅ 구현 완료 / 🔄 Supervisor 통합 진행 중

**핵심 기능**
- Research Agent의 분석 결과 + Strategy Agent의 전략 제안 통합
- Integrated Investment Dashboard 생성 (마크다운 형식)
- Executive Summary, Actionable Insights, Risk Analysis 포함
- LLM 기반 자연어 리포트 생성 (GPT-4o, max_tokens=4000)

**리포트 구조**

```
📊 Comprehensive Investment Analysis Report
├─ 🎯 Executive Summary (2-3문장 핵심 요약)
├─ 📈 Research Analysis Highlights
│   ├─ Investment Thesis Scorecard
│   └─ Critical Metrics
├─ 🎬 Strategic Blueprint
│   ├─ Market Positioning
│   └─ Sector Strategy
├─ 💡 Actionable Insights
│   ├─ Immediate Actions (This Week)
│   ├─ Short-term Strategy (1-3 Months)
│   └─ Risk Management
├─ ⚠️ Key Risks & Monitoring Points
└─ 📋 Investment Decision Checklist
```

**통합 예정**
- Phase 1 완료 시 Supervisor에 통합
- 종합 분석 요청 시 자동 호출 (research + strategy 완료 후)
- 포트폴리오 리밸런싱 시 최종 리포트 생성

---

## 5. User Flow

### 5.1 온보딩 프로세스

```
[회원가입/로그인]
        ↓
[초기 스크리닝] ← 다른 팀원 담당
  - 투자 목표 설정
  - 위험 성향 파악
  - 투자 기간 설정
  - 자동화 레벨 선택
        ↓
[전략 생성]
  - AI가 사용자 프로필 기반 전략 제안
  - 예: "중장기 성장형", "배당 중심 안정형"
        ↓
[포트폴리오 구성] ← HITL 개입
  - AI가 초안 생성
  - 자동화 레벨에 따라:
    * Lv1: 수용/거부
    * Lv2: 수용/보수적/공격적
    * Lv3: 상세 조정
        ↓
[매매 실행 승인] ← HITL 개입
  - 최종 거래 내역 확인
  - 자동화 레벨에 따라:
    * Lv1: 최종 확인만
    * Lv2: 승인 필요
    * Lv3: 개별 종목 승인
        ↓
[온보딩 완료]
  - 거래 내역 저장
  - 메인 대시보드로 이동

```

### 5.2 메인 프로세스 (Chat 인터페이스)

**일반적인 질의응답 플로우**

```
사용자 입력 (Chat)
        ↓
마스터 에이전트 (의도 분류)
        ↓
적절한 에이전트(들) 호출
        ↓
[필요시] HITL 개입 트리거
        ↓
결과 통합 및 응답 생성
        ↓
사용자에게 표시

```

**예시 1: 종목 평가 요청**

```
사용자: "삼성전자 지금 사도 될까?"
        ↓
마스터 → 리서치 에이전트 (기업 분석)
     → 전략 에이전트 (매매 타이밍 판단)
     → 리스크 에이전트 (리스크 평가)
        ↓
통합 결과:
"📊 삼성전자 분석 결과

 **기업 평가**: ⭐⭐⭐⭐ (4/5)
 - 최근 실적: 양호 (영업이익 전년비 +15%)
 - 기술적 지표: 단기 과매수 신호

 **매매 의견**: HOLD → BUY 전환 대기
 - 현재 가격: 76,000원 (목표가 대비 +3%)
 - 추천 매수가: 73,000원 이하

 **리스크**: 중간
 - 반도체 업황 불확실성

 💡 권장: 2주 후 실적 발표 후 재평가 추천"

```

**예시 2: 매매 지시 (HITL 발동)**

```
사용자: "삼성전자 1000만원어치 매수해줘"
        ↓
마스터 → 전략 에이전트 (주문 생성)
     → 리스크 에이전트 (리스크 체크)
        ↓
[리스크 경고 발생] ← 기존 삼성전자 보유 비중 높음
        ↓
HITL 개입 트리거 → 사용자 승인 요청
        ↓
"⚠️ 매매 실행 전 확인이 필요합니다

 **주문 내역**
 - 종목: 삼성전자
 - 금액: 10,000,000원
 - 예상 수량: 131주

 **리스크 경고**
 - 현재 삼성전자 보유: 25%
 - 매수 후 예상 비중: 43% ⚠️

 📊 과거 데이터:
 단일 종목 40% 이상 시 평균 수익률 -6.8%

 💡 권장 대안:
 1. 매수 금액을 500만원으로 조정 (비중 34%)
 2. 같은 섹터 SK하이닉스로 분산

 [취소] [금액 수정] [그대로 진행]"

```

**예시 3: 포트폴리오 리밸런싱 요청**

```
사용자: "포트폴리오 리밸런싱해줘"
        ↓
마스터 → 포트폴리오 에이전트 (분석 + 제안)
        ↓
현재 vs 목표 비교 → 리밸런싱안 생성
        ↓
HITL 개입 (자동화 레벨에 따라)
        ↓
[레벨 2 - 코파일럿 모드 예시]
"📊 리밸런싱 제안

 **현재 포트폴리오**
 - 삼성전자: 35% (목표 30%)
 - SK하이닉스: 15% (목표 20%)
 - NAVER: 10% (목표 15%)
 - 현금: 40%

 **제안 거래**
 - 삼성전자 매도: 200만원
 - SK하이닉스 매수: 150만원
 - NAVER 매수: 150만원

 **예상 효과**
 - 리스크 감소: 18.5% → 16.2%
 - 예상 수익률: 유지

 [수용] [보수적으로] [공격적으로] [취소]"

```

**예시 4: AI 자체 판단 요청 (후순위)**

```
[시스템 내부 프로세스]

전략 에이전트:
  Bull 서브: "삼성전자 상승 예상" (신뢰도 53%)
  Bear 서브: "삼성전자 하락 예상" (신뢰도 47%)
        ↓
[의견 차이 < 10%p 감지]
        ↓
마스터 에이전트 → HITL 트리거
        ↓
"🤔 AI 판단이 명확하지 않습니다

 **삼성전자 전망**

 📈 상승 의견 (53%)
 - 근거: 반도체 업황 개선 조짐
 - 근거: 기술적으로 지지선 확인
 - 신뢰도: ★★★☆☆

 📉 하락 의견 (47%)
 - 근거: 글로벌 경기 둔화 우려
 - 근거: 단기 과매수 신호
 - 신뢰도: ★★★☆☆

 💭 당신의 판단이 필요합니다
 [상승에 베팅] [중립 유지] [하락에 대비]"

```

---

## 6. MVP Feature Requirements

### 6.1 Phase 1 - MVP (핵심 기능) ✅ 90% 완료

| 기능 | 우선순위 | HITL | 복잡도 | 상태 |
| --- | --- | --- | --- | --- |
| **Chat 인터페이스** | P0 | - | Low | ✅ 완료 |
| **마스터 에이전트 (Supervisor)** | P0 | - | Medium | ✅ 완료 |
| **자동화 레벨 설정 (HITLConfig)** | P0 | Yes | Low | ✅ 완료 |
| **종목 검색 및 기본 정보** | P0 | No | Low | ✅ 완료 |
| **기업 재무 분석 (DART)** | P0 | No | Medium | ✅ 완료 |
| **뉴스/공시 모니터링** | P0 | No | Medium | ✅ 완료 |
| **종목 매수/매도 추천** | P0 | Yes | High | ✅ 완료 |
| **포트폴리오 구성 제안** | P0 | Yes | High | ✅ 완료 |
| **리스크 평가 및 경고** | P0 | Yes | Medium | ✅ 완료 |
| **HITL 승인 인터페이스** | P0 | Yes | Medium | ✅ 완료 |
| **한국투자증권 API 연동** | P0 | - | Medium | ✅ 완료 |
| **DART API 연동** | P0 | - | Low | ✅ 완료 |
| **한국은행 API 연동** | P1 | - | Low | ✅ 완료 |
| **AI 권고안 제시 시스템** | P1 | Yes | Medium | ✅ 완료 |
| **모니터링 에이전트 (명시적)** | P1 | No | Medium | 🔄 진행 중 |
| **UserSettings 저장소** | P0 | - | Low | ✅ 완료 |
| **종목명 추출 (LLM 기반)** | P1 | - | Medium | ✅ 완료 |

### 6.2 Phase 2 - 확장 (추가 기능)

| 기능 | 우선순위 | HITL | 복잡도 | 비고 |
| --- | --- | --- | --- | --- |
| **사용자 계정 시스템** | P0 | - | Medium | 필수 |
| **투자 성향 진단** | P0 | No | Low | 초기 스크리닝 |
| **포트폴리오 추적 및 히스토리** | P0 | No | Medium | - |
| **리밸런싱 자동 제안** | P1 | Yes | High | - |
| **모니터링 에이전트 (트리거)** | P1 | No | High | 알림 시스템 |
| **백테스팅 시뮬레이션** | P1 | No | High | - |
| **Bull/Bear 토론 시각화** | P1 | - | Medium | 고급 기능 |
| **사용자 행동 학습** | P2 | - | High | 개인화 |
| **자동화 레벨 커스터마이징** | P1 | Yes | Medium | 세부 설정 |
| 실시간 Push 알림 | P2 | No | Medium | - |

### 6.3 Phase 3 - 미래 (확장 계획)

| 기능 | 우선순위 | 복잡도 | 비고 |
| --- | --- | --- | --- |
| **해외 주식 지원** | P1 | Very High | 미국, 일본 우선 |
| **실제 매매 실행** | P2 | Very High | 증권사 API 연동 |
| **모바일 앱** | P1 | High | iOS/Android |
| **음성 인터페이스** | P2 | Medium | 음성 명령 |
| **소셜 기능** | P2 | Medium | 커뮤니티 |

---

## 7. Technical Requirements

### 7.1 데이터 소스

| 소스 | 제공 정보 | 연동 방법 | 상태 |
| --- | --- | --- | --- |
| pykrx | KRX 시장 데이터 (주가, 거래량) | Python Library | ✅ 완료 |
| 한국투자증권 API | 실시간 시세, 차트, 호가 | REST API | ✅ 완료 |
| DART | 공시 문서, 재무제표 | REST API | ✅ 완료 |
| 한국은행 API | 금리, 거시경제 지표 | REST API | ✅ 완료 |
| 뉴스 크롤링 | 네이버 금융, 증권 뉴스 | Web Scraping | ⏸️ Phase 2 |

### 7.2 실시간 정보 제공 방법

**별도 문서 참조**: "실시간 정보 제공 방법 비교 (MCP vs Alternatives)"

### 7.3 Tech Stack (간략)

| 구성 요소 | 기술 | 비고 |
| --- | --- | --- |
| AI Framework | LangChain / LangGraph | langgraph-supervisor 사용 |
| LLM | GPT-4o, Claude Sonnet 4.5 | Router: Claude, 기타: GPT-4o |
| Backend | FastAPI (Python) | 동기 SQLAlchemy |
| Frontend | Next.js (React) | Phase 2 |
| Database | PostgreSQL | 동기 세션 |
| Vector DB | Pinecone (DART RAG) | Phase 2 |
| Checkpointer | PostgreSQL / Memory | PostgreSQL (프로덕션) |
| Cache | 인메모리 | TTL 60초 |

---

## 8. Success Metrics

### 8.1 MVP 성공 지표

| 지표 | 목표 |
| --- | --- |
| 핵심 기능 완성도 | 100% |
| 시스템 안정성 | Uptime 95%+ |
| 평균 응답 속도 | < 3초 |
| 베타 테스트 완료 | 5명+ |
| 사용자 만족도 | 긍정 80%+ |

### 8.2 Phase 2+ 지표

| 지표 | 목표 |
| --- | --- |
| AI 추천 수용률 | > 60% |
| 일간 활성 사용자 | 70%+ |
| 재방문율 | 주 3회+ |
| HITL 개입 만족도 | > 75% |

---

## 9. Constraints & Assumptions

### 9.1 제약사항

- **MVP 범위**: 실제 매매 실행 없음 (시뮬레이션만)
- **시장**: 한국 주식만 지원
- **사용자 계정**: Phase 2에서 구현
- **실시간성**: 5분 지연 허용

### 9.2 가정 (추후 페르소나 분석을 통해 구체화)

- 사용자는 한국투자증권 계좌 보유
- 사용자는 기본적인 투자 용어 이해
- 데이터 API 사용 제한 없음
- Chat 인터페이스에 익숙함

---

## 10. Risk Analysis

| 리스크 | 영향도 | 완화 방안 |
| --- | --- | --- |
| API 사용 제한 | High | 캐싱, Rate limiting |
| AI 응답 품질 | High | Prompt engineering, Evaluation |
| 복잡한 HITL 로직 | Medium | 단계적 구현, 충분한 테스트 |
| 사용자 이탈 | Medium | 온보딩 최적화, 튜토리얼 |

---

## 11. Out of Scope

**MVP에서 제외**

- ❌ 실제 매매 실행 (Phase 2)
- ❌ 사용자 계정/인증 (Phase 2)
- ❌ 해외 주식 (Phase 3)
- ❌ 모바일 앱 (Phase 3)
- ❌ 소셜 기능 (Phase 3)
- ❌ AI 추론 과정 완전 공개 (구현 복잡도 및 사용자 혼란 우려)
- ❌ 실시간 Push 알림 (Phase 2)
- ❌ 고급 개인화 (행동 학습 등은 Phase 2)
- ❌ 백테스팅 (Phase 2)
- ❌ 컴플라이언스 자동화 (Phase 2)

**명확한 제외 사항**

- ❌ AI의 모든 추론 과정 공개: 기술적으로 복잡하고 사용자에게 오히려 혼란을 줄 수 있음. 대신 Bull/Bear 분석 등 핵심 의사결정 근거만 제공
- ~~❌ 완전 자동 매매: 사용자 승인 없는 자동 거래는 법적/윤리적 이슈 존재~~

---

## 12. Next Steps

### ✅ Phase 1 완료 항목 (92%)

**핵심 아키텍처**
1. ✅ LangGraph Supervisor 패턴 구현 (langgraph-supervisor)
2. ✅ Router Agent 구현 (Claude Sonnet 4.5 기반 질문 분석)
3. ✅ 6개 서브그래프 에이전트 구현
   - Research (7 Workers, 동적 선택)
   - Strategy (3 Specialists)
   - Risk (단일 노드)
   - Trading (HITL)
   - Portfolio (3 Nodes)
   - Monitoring (배경 작업)
4. ✅ Report Generator 구현 (통합 리포트 생성)

**데이터 & 서비스**
5. ✅ 데이터 연동 (pykrx, KIS, DART, BOK)
6. ✅ 인메모리 캐싱 시스템 (TTL 60초)
7. ✅ 15+ 서비스 레이어 구현
8. ✅ 종목명 추출 개선 (Claude Sonnet 4.5 기반)

**HITL & 설정**
9. ✅ HITL 시스템 확장 (HITLConfig, UserSettings)
10. ✅ Settings API (자동화 레벨 관리)
11. ✅ 3단계 자동화 레벨 시스템

**문서 & 설계**
12. ✅ PRD 검토 및 승인
13. ✅ 유저 플로우 상세 설계
14. ✅ 데이터 스키마 설계
15. ✅ API 명세 작성 및 구현

### 🔄 Phase 1 남은 작업 (8%)

- [ ] Report Generator → Supervisor 통합
- [ ] 테스트 커버리지 확대
- [ ] API 인증/권한 시스템
- [ ] UI/UX 와이어프레임
- [ ] 프론트엔드 개발

### ⏭️ Phase 2 계획

- [ ] 실제 매매 주문 실행
- [ ] WebSocket 실시간 알림
- [ ] 뉴스 크롤링 (네이버 금융)
- [ ] 사용자 인증 시스템 (JWT)
- [ ] 포트폴리오 백테스팅
- [ ] 자동화 레벨 커스터마이징 (세부 조정)

---

**문서 끝**

**Last Updated: 2025-11-08** | **완성도: 92%** | **아키텍처: LangGraph Supervisor 패턴**
