"""
Strategy Dashboard í…œí”Œë¦¿

Strategic Blueprintì„ ì „ë¬¸ì ì¸ Dashboard í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
"""
from typing import Dict, Any


STRATEGY_DASHBOARD_TEMPLATE = """
# ğŸ“Š Strategic Investment Blueprint
Generated: {date} | Confidence: {confidence}%

---

## ğŸ¯ Investment Strategy Summary

**Market Cycle**: {market_cycle}
**Strategic Stance**: {strategic_stance}
**Recommended Allocation**: Stocks {stock_ratio}% | Cash {cash_ratio}%

{summary}

---

## ğŸ“ˆ Market Cycle Analysis

**Current Phase**: {market_cycle_detail}

{market_analysis}

**Key Market Indicators**:
{market_indicators}

---

## ğŸ­ Sector Allocation Strategy

**Overweight Sectors** (ë†’ì€ ë¹„ì¤‘ ê¶Œì¥):
{overweight_sectors}

**Underweight Sectors** (ë‚®ì€ ë¹„ì¤‘ ê¶Œì¥):
{underweight_sectors}

**Rationale**: {sector_rationale}

---

## ğŸ’° Asset Allocation Breakdown

```
Stocks:  {stock_ratio}% [{stock_bar}]
Cash:    {cash_ratio}% [{cash_bar}]
```

**Allocation Rationale**: {allocation_rationale}

**Portfolio Constraints**:
- ìµœëŒ€ ì¢…ëª© ìˆ˜: {max_stocks}ê°œ
- ì¢…ëª©ë‹¹ ìµœëŒ€ ë¹„ì¤‘: {max_per_stock}%
- ìµœì†Œ ì¢…ëª© ìˆ˜: {min_stocks}ê°œ

---

## ğŸ¬ Investment Action Plan

{action_plan}

---

## âš ï¸ Risk Management Framework

**Stop-Loss Triggers**:
{stop_loss_triggers}

**Rebalancing Conditions**:
{rebalancing_conditions}

**Key Assumptions to Monitor**:
{key_assumptions}

---

## ğŸ’¡ Next Steps

{next_steps}

---

*This blueprint is generated by AI and should be used as a decision support tool. Always conduct your own due diligence.*
"""


def build_strategy_dashboard_prompt(
    market_outlook: Dict[str, Any],
    sector_strategy: Dict[str, Any],
    asset_allocation: Dict[str, Any],
    investment_style: Dict[str, Any],
    risk_tolerance: str,
    constraints: Dict[str, Any],
    confidence_score: float,
    key_assumptions: list,
) -> str:
    """
    Strategy Dashboard ìƒì„± í”„ë¡¬í”„íŠ¸

    Args:
        market_outlook: ì‹œì¥ ì „ë§
        sector_strategy: ì„¹í„° ì „ëµ
        asset_allocation: ìì‚° ë°°ë¶„
        investment_style: íˆ¬ì ìŠ¤íƒ€ì¼
        risk_tolerance: ë¦¬ìŠ¤í¬ í—ˆìš©ë„
        constraints: ì œì•½ ì¡°ê±´
        confidence_score: ì‹ ë¢°ë„
        key_assumptions: ì£¼ìš” ê°€ì •

    Returns:
        Dashboard ìƒì„± í”„ë¡¬í”„íŠ¸
    """
    from ..utils import build_prompt
    from datetime import datetime

    # ì»¨í…ìŠ¤íŠ¸ ë°ì´í„° ì¤€ë¹„
    context = {
        "market_cycle": market_outlook.get("cycle", "expansion"),
        "market_confidence": market_outlook.get("confidence", 0.75),
        "market_summary": market_outlook.get("summary", ""),
        "overweight_sectors": sector_strategy.get("overweight", []),
        "underweight_sectors": sector_strategy.get("underweight", []),
        "sector_rationale": sector_strategy.get("rationale", ""),
        "stock_ratio": asset_allocation.get("stocks", 0.7),
        "cash_ratio": asset_allocation.get("cash", 0.3),
        "allocation_rationale": asset_allocation.get("rationale", ""),
        "investment_style": investment_style.get("type", "growth"),
        "horizon": investment_style.get("horizon", "mid_term"),
        "risk_tolerance": risk_tolerance,
        "max_stocks": constraints.get("max_stocks", 10),
        "max_per_stock": constraints.get("max_per_stock", 0.20),
        "min_stocks": constraints.get("min_stocks", 5),
        "confidence_score": confidence_score,
        "key_assumptions": key_assumptions,
    }

    task = """ìœ„ì˜ ì „ëµ ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì „ë¬¸ì ì¸ Strategic Investment Blueprint Dashboardë¥¼ ìƒì„±í•˜ì„¸ìš”.

ìš”êµ¬ì‚¬í•­:
1. **ëª…í™•ì„±**: íˆ¬ììê°€ ì¦‰ì‹œ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ê°„ê²°í•˜ê³  ëª…í™•í•˜ê²Œ ì‘ì„±
2. **ì‹¤í–‰ ê°€ëŠ¥ì„±**: êµ¬ì²´ì ì¸ ì•¡ì…˜ ì•„ì´í…œ í¬í•¨ (ë‹¤ìŒ ì£¼ì— ë¬´ì—‡ì„ í•  ê²ƒì¸ê°€?)
3. **ë¦¬ìŠ¤í¬ ê´€ë¦¬**: ì†ì ˆ ê¸°ì¤€, ë¦¬ë°¸ëŸ°ì‹± ì¡°ê±´ ëª…ì‹œ
4. **ë°ì´í„° ê¸°ë°˜**: ì •ëŸ‰ì  ìˆ˜ì¹˜ì™€ ê·¼ê±° í¬í•¨

Dashboard ì„¹ì…˜ë³„ ê°€ì´ë“œ:

**Investment Strategy Summary**:
- Strategic StanceëŠ” ì‹œì¥ ì‚¬ì´í´ê³¼ ë¦¬ìŠ¤í¬ í—ˆìš©ë„ë¥¼ ì¢…í•©í•˜ì—¬ ê²°ì • (ì˜ˆ: "Moderate Bullish", "Defensive")
- í•µì‹¬ ì „ëµì„ 2-3ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½

**Market Cycle Analysis**:
- í˜„ì¬ ì‚¬ì´í´ ë‹¨ê³„ì˜ íŠ¹ì§• ì„¤ëª…
- ì£¼ìš” ì§€í‘œ 3-5ê°œ ë‚˜ì—´ (ì˜ˆ: "KOSPI +15% YTD", "IT ì„¹í„° outperformance")

**Sector Allocation Strategy**:
- Overweight/Underweight ì„¹í„° ê°ê° 3-5ê°œ ë‚˜ì—´
- ê° ì„¹í„°ì— ëŒ€í•œ ê°„ë‹¨í•œ ê·¼ê±° í¬í•¨

**Investment Action Plan**:
- êµ¬ì²´ì ì¸ ì‹¤í–‰ ë‹¨ê³„ (ì˜ˆ: "1ì£¼ì°¨: IT ì„¹í„° 25% ë°°ë¶„", "2ì£¼ì°¨: ë¦¬ë°¸ëŸ°ì‹±")
- ìš°ì„ ìˆœìœ„ í‘œì‹œ

**Risk Management Framework**:
- Stop-Loss Triggers: ì–´ë–¤ ìƒí™©ì—ì„œ ì „ëµì„ í¬ê¸°í•  ê²ƒì¸ê°€?
- Rebalancing Conditions: ì–¸ì œ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì¡°ì •í•  ê²ƒì¸ê°€?

**Next Steps**:
- ì´ë²ˆ ì£¼/ë‹¤ìŒ ì£¼ì— í•´ì•¼ í•  êµ¬ì²´ì ì¸ ì•¡ì…˜ 3-5ê°œ"""

    output_format = f"""ë‹¤ìŒ í…œí”Œë¦¿ì„ ì±„ì›Œì„œ ë°˜í™˜í•˜ì„¸ìš”:

{STRATEGY_DASHBOARD_TEMPLATE}

í…œí”Œë¦¿ ë³€ìˆ˜ ì„¤ëª…:
- {{date}}: í˜„ì¬ ë‚ ì§œ (YYYY-MM-DD í˜•ì‹)
- {{confidence}}: ì‹ ë¢°ë„ (0-100)
- {{market_cycle}}: "í™•ì¥ê¸°", "ì •ì ", "ìˆ˜ì¶•ê¸°", "ì €ì " ì¤‘ í•˜ë‚˜
- {{strategic_stance}}: "Aggressive Bullish", "Moderate Bullish", "Neutral", "Defensive" ë“±
- {{stock_ratio}}, {{cash_ratio}}: ìì‚° ë°°ë¶„ ë¹„ìœ¨ (ì •ìˆ˜)
- {{summary}}: 2-3ë¬¸ì¥ ìš”ì•½
- {{market_cycle_detail}}: ì‹œì¥ ì‚¬ì´í´ ìƒì„¸ ì„¤ëª… (2-3ë¬¸ì¥)
- {{market_analysis}}: ì‹œì¥ ë¶„ì„ (3-4ë¬¸ì¥)
- {{market_indicators}}: ì£¼ìš” ì§€í‘œ ë¦¬ìŠ¤íŠ¸ (ë¶ˆë¦¿ í¬ì¸íŠ¸)
- {{overweight_sectors}}, {{underweight_sectors}}: ì„¹í„° ë¦¬ìŠ¤íŠ¸ (ë¶ˆë¦¿ í¬ì¸íŠ¸, ê° ì„¹í„°ì— ê·¼ê±° í¬í•¨)
- {{sector_rationale}}: ì„¹í„° ì „ëµ ê·¼ê±° (2-3ë¬¸ì¥)
- {{allocation_rationale}}: ìì‚° ë°°ë¶„ ê·¼ê±° (2-3ë¬¸ì¥)
- {{stock_bar}}, {{cash_bar}}: ë§‰ëŒ€ ê·¸ë˜í”„ (ì˜ˆ: "â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘")
- {{max_stocks}}, {{max_per_stock}}, {{min_stocks}}: í¬íŠ¸í´ë¦¬ì˜¤ ì œì•½
- {{action_plan}}: ì‹¤í–‰ ê³„íš (ë²ˆí˜¸ ë§¤ê¸´ ë¦¬ìŠ¤íŠ¸)
- {{stop_loss_triggers}}: ì†ì ˆ íŠ¸ë¦¬ê±° (ë¶ˆë¦¿ í¬ì¸íŠ¸)
- {{rebalancing_conditions}}: ë¦¬ë°¸ëŸ°ì‹± ì¡°ê±´ (ë¶ˆë¦¿ í¬ì¸íŠ¸)
- {{key_assumptions}}: ì£¼ìš” ê°€ì • (ë¶ˆë¦¿ í¬ì¸íŠ¸)
- {{next_steps}}: ë‹¤ìŒ ë‹¨ê³„ (ë²ˆí˜¸ ë§¤ê¸´ ë¦¬ìŠ¤íŠ¸)

**ì¤‘ìš”**: í…œí”Œë¦¿ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë˜, {{}} ì•ˆì˜ ëª¨ë“  ë³€ìˆ˜ë¥¼ ì‹¤ì œ ê°’ìœ¼ë¡œ ì±„ì›Œì•¼ í•©ë‹ˆë‹¤."""

    examples = [
        {
            "input": "í™•ì¥ê¸°, ì£¼ì‹ 70%, IT/ê¸ˆìœµ overweight",
            "output": """# ğŸ“Š Strategic Investment Blueprint
Generated: 2025-01-15 | Confidence: 85%

---

## ğŸ¯ Investment Strategy Summary

**Market Cycle**: í™•ì¥ê¸° (Expansion)
**Strategic Stance**: Moderate Bullish
**Recommended Allocation**: Stocks 70% | Cash 30%

ê²½ê¸° í™•ì¥ê¸° ì§„ì…ê³¼ í•¨ê»˜ ITÂ·ê¸ˆìœµ ì„¹í„°ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê³µê²©ì  ì„±ì¥ ì „ëµì„ êµ¬ì‚¬í•©ë‹ˆë‹¤. ë‹¤ë§Œ ë³€ë™ì„± ëŒ€ë¹„ í˜„ê¸ˆ 30% ë³´ìœ ë¡œ ë¦¬ìŠ¤í¬ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

---

## ğŸ“ˆ Market Cycle Analysis

**Current Phase**: í™•ì¥ê¸° ì´ˆì… - ê²½ê¸° íšŒë³µì„¸ ì§€ì†

KOSPIê°€ ì €ì  ëŒ€ë¹„ 12% ë°˜ë“±í•˜ë©° í™•ì¥ê¸° ì§„ì… ì‹ í˜¸ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. IT ì—…ì¢…ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì‹¤ì  ê°œì„ ì´ ëšœë ·í•˜ë©°, ê¸ˆë¦¬ ì¸í•˜ ê¸°ëŒ€ê°ì´ ì‹œì¥ì„ ì§€ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.

**Key Market Indicators**:
- KOSPI +12% from recent low
- IT sector leading with +18% performance
- Foreign investors net buying for 5 consecutive weeks
- VIX declining to 14 (low volatility environment)

---

## ğŸ­ Sector Allocation Strategy

**Overweight Sectors** (ë†’ì€ ë¹„ì¤‘ ê¶Œì¥):
- **IT (ì •ë³´ê¸°ìˆ )**: AIÂ·ë°˜ë„ì²´ ì—…í™© íšŒë³µ, ê¸€ë¡œë²Œ ìˆ˜ìš” ì¦ê°€
- **ê¸ˆìœµ**: ê¸ˆë¦¬ ì•ˆì •í™”, NIM ê°œì„  ê¸°ëŒ€
- **ì†Œë¹„ì¬**: ì†Œë¹„ì‹¬ë¦¬ íšŒë³µ, ëª…ì ˆ íŠ¹ìˆ˜ ê¸°ëŒ€

**Underweight Sectors** (ë‚®ì€ ë¹„ì¤‘ ê¶Œì¥):
- **ì—ë„ˆì§€**: ìœ ê°€ ë¶ˆí™•ì‹¤ì„±, ìˆ˜ê¸‰ ë¶ˆê· í˜•
- **ì†Œì¬**: ì¤‘êµ­ ê²½ê¸° ë‘”í™” ì˜í–¥

**Rationale**: í™•ì¥ê¸° ì´ˆì…ì—ëŠ” ê²½ê¸° ë¯¼ê° ì—…ì¢…(IT, ê¸ˆìœµ)ì´ ê°•ì„¸ë¥¼ ë³´ì´ë©°, ë°©ì–´ì  ì„¹í„°ëŠ” ìƒëŒ€ì ìœ¼ë¡œ ë¶€ì§„í•œ íŒ¨í„´ì´ ì—­ì‚¬ì ìœ¼ë¡œ ë°˜ë³µë˜ì–´ ì™”ìŠµë‹ˆë‹¤.

---

## ğŸ’° Asset Allocation Breakdown

```
Stocks:  70% [â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘]
Cash:    30% [â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘]
```

**Allocation Rationale**: í™•ì¥ê¸° íŠ¹ì„±ìƒ ì£¼ì‹ ë¹„ì¤‘ì„ 70%ë¡œ ë†’ì´ë˜, ë³€ë™ì„± ëŒ€ë¹„ í˜„ê¸ˆ 30% ë³´ìœ ë¡œ ê¸‰ë½ ì‹œ ì¶”ê°€ ë§¤ìˆ˜ ì—¬ë ¥ì„ í™•ë³´í•©ë‹ˆë‹¤.

**Portfolio Constraints**:
- ìµœëŒ€ ì¢…ëª© ìˆ˜: 10ê°œ
- ì¢…ëª©ë‹¹ ìµœëŒ€ ë¹„ì¤‘: 20%
- ìµœì†Œ ì¢…ëª© ìˆ˜: 5ê°œ

---

## ğŸ¬ Investment Action Plan

1. **1ì£¼ì°¨**: IT ì„¹í„° 25% ë°°ë¶„ (ì‚¼ì„±ì „ì, SKí•˜ì´ë‹‰ìŠ¤ ë“± ëŒ€í˜•ì£¼ ì¤‘ì‹¬)
2. **2ì£¼ì°¨**: ê¸ˆìœµ ì„¹í„° 20% ë°°ë¶„ (KBê¸ˆìœµ, ì‹ í•œì§€ì£¼)
3. **3ì£¼ì°¨**: ì†Œë¹„ì¬ 15% ë°°ë¶„ (LGìƒí™œê±´ê°•, ì•„ëª¨ë ˆí¼ì‹œí”½)
4. **4ì£¼ì°¨**: ë‚˜ë¨¸ì§€ 10% ë°°ë¶„ ë° í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬ë·°

---

## âš ï¸ Risk Management Framework

**Stop-Loss Triggers**:
- KOSPIê°€ ì£¼ë´‰ ê¸°ì¤€ 200ì¼ ì´í‰ì„  í•˜í–¥ ì´íƒˆ
- IT ì„¹í„°ê°€ 2ì£¼ ì—°ì† -5% ì´ìƒ í•˜ë½
- ê¸ˆë¦¬ ê¸‰ë“± (10ë…„ë¬¼ êµ­ê³ ì±„ +50bp ì´ìƒ)

**Rebalancing Conditions**:
- ì›” 1íšŒ ì •ê¸° ë¦¬ë°¸ëŸ°ì‹±
- ì„¹í„° ë¹„ì¤‘ì´ ëª©í‘œ ëŒ€ë¹„ Â±5%p ì´ìƒ ì´íƒˆ ì‹œ
- ì‹œì¥ ì‚¬ì´í´ ì „í™˜ ì‹ í˜¸ í¬ì°© ì‹œ

**Key Assumptions to Monitor**:
- í™•ì¥ê¸° êµ­ë©´ ì§€ì† (KOSPI ìƒìŠ¹ ì¶”ì„¸ ìœ ì§€)
- IT ì„¹í„° ì‹¤ì  ê°œì„  ì§€ì†
- ê¸ˆë¦¬ ì•ˆì •í™” (ê¸‰ê²©í•œ ë³€ë™ ì—†ìŒ)

---

## ğŸ’¡ Next Steps

1. **ì´ë²ˆ ì£¼**: ì¦ê¶Œì‚¬ ê³„ì¢Œ ì ê²€ ë° í˜„ê¸ˆ í™•ë³´
2. **ë‹¤ìŒ ì£¼**: IT ëŒ€í˜•ì£¼ 25% ë§¤ìˆ˜ (ë¶„í•  ë§¤ìˆ˜)
3. **2ì£¼ í›„**: ê¸ˆìœµì£¼ ì¶”ê°€ ë§¤ìˆ˜ ë° í¬íŠ¸í´ë¦¬ì˜¤ ë°¸ëŸ°ìŠ¤ í™•ì¸
4. **ì›”ë§**: ì²« ë¦¬ë°¸ëŸ°ì‹± ë° ìˆ˜ìµë¥  ì ê²€

---

*This blueprint is generated by AI and should be used as a decision support tool. Always conduct your own due diligence.*"""
        }
    ]

    guidelines = """1. ëª¨ë“  í…œí”Œë¦¿ ë³€ìˆ˜ë¥¼ ì‹¤ì œ ê°’ìœ¼ë¡œ ì±„ìš¸ ê²ƒ
2. ë§‰ëŒ€ ê·¸ë˜í”„ëŠ” 10ì¹¸ ê¸°ì¤€ (ì˜ˆ: 70% = 7ì¹¸ â–“, 3ì¹¸ â–‘)
3. ë‚ ì§œëŠ” í˜„ì¬ ë‚ ì§œ ì‚¬ìš©
4. ì‹ ë¢°ë„ëŠ” 0-100 ì •ìˆ˜ë¡œ í‘œì‹œ
5. ì„¹í„°ëª…ì€ í•œê¸€ ì‚¬ìš©, ê´„í˜¸ ì•ˆì— ì˜ë¬¸ í‘œê¸° ê°€ëŠ¥
6. ìˆ˜ì¹˜ëŠ” ì†Œìˆ˜ì  ì´í•˜ ë°˜ì˜¬ë¦¼ (ì˜ˆ: 70%, not 70.0%)
7. ë¶ˆë¦¿ í¬ì¸íŠ¸ëŠ” "-" ì‚¬ìš©
8. ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸ëŠ” "1.", "2." í˜•ì‹ ì‚¬ìš©"""

    return build_prompt(
        role="Strategic Blueprint Dashboard Generator",
        context=context,
        task=task,
        output_format=output_format,
        examples=examples,
        guidelines=guidelines,
    )
